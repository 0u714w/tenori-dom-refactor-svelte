var e=require("graphql"),t=require("./2dd3cb41.min.js"),r=require("wonka");function n(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)n(e[r],t);else if("object"==typeof e&&null!==e)for(var i in e)"__typename"===i&&"string"==typeof e[i]?t[e[i]]=0:n(e[i],t);return t}function i(e){return Object.keys(n(e,{}))}var o=function(r){if(r.selectionSet&&!r.selectionSet.selections.some((function(t){return t.kind===e.Kind.FIELD&&"__typename"===t.name.value&&!t.alias})))return t._extends({},r,{selectionSet:t._extends({},r.selectionSet,{selections:r.selectionSet.selections.concat([{kind:e.Kind.FIELD,name:{kind:e.Kind.NAME,value:"__typename"}}])})})},u=new Map;function a(r){var n=t.keyDocument(r),i=u.get(n.__key);return i||((i=e.visit(n,{Field:o,InlineFragment:o})).__key=n.__key,u.set(n.__key,i)),i}function s(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,r){var n=e[r];return"__typename"===r?Object.defineProperty(t,"__typename",{enumerable:!1,value:n}):t[r]=Array.isArray(n)?n.map(s):n&&"object"==typeof n&&"__typename"in n?s(n):n,t}),{}):e}function c(e){return e.toPromise=function(){return r.toPromise(r.take(1)(e))},e}function f(e,t,r){return r||(r=t.context),{key:t.key,query:t.query,variables:t.variables,kind:e,context:r}}function p(e,r){return f(e.kind,e,t._extends({},e.context,{meta:t._extends({},e.context.meta,r)}))}function l(){}function d(r,n,i){for(var o=0;o<i.length;o++)if(i[o].kind===e.Kind.FRAGMENT_DEFINITION){var u=i[o].name.value,a=t.stringifyDocument(i[o]);r.has(u)||(r.set(u,a),n.push(i[o]))}else n.push(i[o])}function h(e){var t=e.kind;return"subscription"!==t&&"query"!==t}function y(e){var t=e.kind;return"mutation"!==t&&"query"!==t}function k(e){var n=e.forward,o=e.client,u=new Map,s=Object.create(null);function c(e){var t=f(e.kind,e);return t.query=a(e.query),t}function l(e){var t=e.context.requestPolicy;return"query"===e.kind&&"network-only"!==t&&("cache-only"===t||u.has(e.key))}return function(e){var a=r.share(e),f=r.map((function(e){var r=u.get(e.key),n=t._extends({},r,{operation:p(e,{cacheOutcome:r?"hit":"miss"})});return"cache-and-network"===e.context.requestPolicy&&(n.stale=!0,m(o,e)),n}))(r.filter((function(e){return!y(e)&&l(e)}))(a)),d=r.tap((function(e){var t=e.operation;if(t){var r=i(e.data).concat(t.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var n=new Set,a=0;a<r.length;a++){var c=r[a],f=s[c]||(s[c]=new Set);f.forEach((function(e){n.add(e)})),f.clear()}n.forEach((function(e){u.has(e)&&(t=u.get(e).operation,u.delete(e),m(o,t))}))}else if("query"===t.kind&&e.data){u.set(t.key,e);for(var p=0;p<r.length;p++){var l=r[p];(s[l]||(s[l]=new Set)).add(t.key)}}}}))(n(r.filter((function(e){return"query"!==e.kind||"cache-only"!==e.context.requestPolicy}))(r.map((function(e){return p(e,{cacheOutcome:"miss"})}))(r.merge([r.map(c)(r.filter((function(e){return!y(e)&&!l(e)}))(a)),r.filter((function(e){return y(e)}))(a)])))));return r.merge([f,d])}}function m(e,r){return e.reexecuteOperation(f(r.kind,r,t._extends({},r.context,{requestPolicy:"network-only"})))}function v(e){var t=e.forward,n=new Set;function i(e){var t=e.key,r=e.kind;if("teardown"===r)return n.delete(t),!0;if("query"!==r&&"subscription"!==r)return!0;var i=n.has(t);return n.add(t),!i}function o(e){n.delete(e.operation.key)}return function(e){var n=r.filter(i)(e);return r.tap(o)(t(n))}}function x(e){var n=e.forward;return function(e){var i=r.share(e),o=r.mergeMap((function(e){var n=e.key,o=r.filter((function(e){return"teardown"===e.kind&&e.key===n}))(i),u=t.makeFetchBody(e),a=t.makeFetchURL(e,u),s=t.makeFetchOptions(e,u);return r.onPush((function(e){}))(r.takeUntil(o)(t.makeFetchSource(e,a,s)))}))(r.filter((function(e){return"query"===e.kind||"mutation"===e.kind}))(i)),u=n(r.filter((function(e){return"query"!==e.kind&&"mutation"!==e.kind}))(i));return r.merge([o,u])}}function g(e){return function(e){return r.filter((function(){return!1}))(r.tap((function(e){}))(e))}}var q=g();function b(e){return function(t){var r=t.client;return e.reduceRight((function(e,t){return t({client:r,forward:e,dispatchDebug:function(e){}})}),t.forward)}}var O=[v,k,x];function w(e){var n=this;this.activeOperations=new Map,this.queue=[],this.createOperationContext=function(e){return e||(e={}),t._extends({},{url:n.url,fetchOptions:n.fetchOptions,fetch:n.fetch,preferGetMethod:n.preferGetMethod},e,{suspense:e.suspense||!1!==e.suspense&&n.suspense,requestPolicy:e.requestPolicy||n.requestPolicy})},this.createRequestOperation=function(e,t,r){return f(e,t,n.createOperationContext(r))},this.executeQuery=function(e,t){var r=n.createRequestOperation("query",e,t);return n.executeRequestOperation(r)},this.executeSubscription=function(e,t){var r=n.createRequestOperation("subscription",e,t);return n.executeRequestOperation(r)},this.executeMutation=function(e,t){var r=n.createRequestOperation("mutation",e,t);return n.executeRequestOperation(r)};var i=l;this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var o=r.makeSubject(),u=o.next;this.operations$=o.source;var a=!1;this.dispatchOperation=function(e){for(a=!0,e&&u(e);e=n.queue.shift();)u(e);a=!1},this.reexecuteOperation=function(e){("mutation"===e.kind||n.activeOperations.has(e.key))&&(n.queue.push(e),a||Promise.resolve().then(n.dispatchOperation))};var s=b(void 0!==e.exchanges?e.exchanges:O);this.results$=r.share(s({client:this,dispatchDebug:i,forward:g()})(this.operations$)),r.publish(this.results$)}w.prototype.executeRequestOperation=function(e){var n=this,i=this.activeOperations.get(e.key);if(!i){var o=r.filter((function(t){return t.operation.kind===e.kind&&t.operation.key===e.key}))(this.results$);if(this.maskTypename&&(o=r.map((function(e){return t._extends({},e,{data:s(e.data)})}))(o)),"mutation"===e.kind)return r.take(1)(r.onStart((function(){return n.dispatchOperation(e)}))(o));i={source:r.share(r.onEnd((function(){i.replay=null,n.activeOperations.delete(e.key);for(var t=n.queue.length-1;t>=0;t--)n.queue[t].key===e.key&&n.queue.splice(t,1);n.dispatchOperation(f("teardown",e,e.context))}))(r.onPush((function(e){i.replay=e}))(r.switchMap((function(i){return i.stale?r.fromValue(i):r.merge([r.fromValue(i),r.map((function(){return t._extends({},i,{stale:!0})}))(r.take(1)(r.filter((function(t){return t.kind===e.kind&&t.key===e.key&&("network-only"===t.context.requestPolicy||"cache-and-network"===t.context.requestPolicy)}))(n.operations$)))])}))(r.takeUntil(r.filter((function(t){return"teardown"===t.kind&&t.key===e.key}))(this.operations$))(o))))),replay:null}}var u=i.replay,a=r.makeSubject(),c="cache-and-network"===e.context.requestPolicy||"network-only"===e.context.requestPolicy;return r.onStart((function(){if(n.activeOperations.set(e.key,i),"subscription"===e.kind)return n.dispatchOperation(e);c&&n.dispatchOperation(e),null!=u&&u===i.replay?a.next(c?t._extends({},u,{stale:!0}):u):c||n.dispatchOperation(e)}))(r.merge([a.source,i.source]))},w.prototype.query=function(e,r,n){return n&&"boolean"==typeof n.suspense||(n=t._extends({},n,{suspense:!1})),c(this.executeQuery(t.createRequest(e,r),n))},w.prototype.readQuery=function(e,t,n){var i=null;return r.subscribe((function(e){i=e}))(this.query(e,t,n)).unsubscribe(),i},w.prototype.subscription=function(e,r,n){return this.executeSubscription(t.createRequest(e,r),n)},w.prototype.mutation=function(e,r,n){return c(this.executeMutation(t.createRequest(e,r),n))},exports.CombinedError=t.CombinedError,exports.createRequest=t.createRequest,exports.getOperationName=t.getOperationName,exports.makeErrorResult=t.makeErrorResult,exports.makeResult=t.makeResult,exports.stringifyVariables=t.stringifyVariables,exports.Client=w,exports.cacheExchange=k,exports.composeExchanges=b,exports.createClient=function(e){return new w(e)},exports.debugExchange=function(e){var t=e.forward;return function(e){return t(e)}},exports.dedupExchange=v,exports.defaultExchanges=O,exports.errorExchange=function(e){var t=e.onError;return function(e){var n=e.forward;return function(e){return r.tap((function(e){var r=e.error;r&&t(r,e.operation)}))(n(e))}}},exports.fallbackExchangeIO=q,exports.fetchExchange=x,exports.formatDocument=a,exports.gql=function(){for(var r=arguments,n=new Map,i=[],o=[],u=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",a=1;a<arguments.length;a++){var s=r[a];s&&s.definitions?o.push.apply(o,s.definitions):u+=s,u+=r[0][a]}return d(n,i,t.keyDocument(u).definitions),d(n,i,o),t.keyDocument({kind:e.Kind.DOCUMENT,definitions:i})},exports.makeOperation=f,exports.maskTypename=s,exports.ssrExchange=function(e){var n={},i=[];function o(e){i.push(e.operation.key),1===i.length&&Promise.resolve().then((function(){for(var e;e=i.shift();)delete n[e]}))}function u(e){return!h(e)&&void 0!==n[e.key]}var a=function(i){var a=i.client,s=i.forward;return function(i){var c=e&&"boolean"==typeof e.isClient?!!e.isClient:!a.suspense,f=r.share(i),p=s(r.filter((function(e){return!u(e)}))(f)),l=r.map((function(e){var r,i,o;return i=(r=n[e.key]).error,{operation:e,data:(o=r.data)?JSON.parse(o):void 0,extensions:void 0,error:i?new t.CombinedError({networkError:i.networkError?new Error(i.networkError):void 0,graphQLErrors:i.graphQLErrors&&i.graphQLErrors.length?i.graphQLErrors:void 0}):void 0}}))(r.filter((function(e){return u(e)}))(f));return c?l=r.tap(o)(l):p=r.tap((function(e){var t=e.operation;if(!h(t)){var r=function(e){var t=e.data,r=e.error,n={};return void 0!==t&&(n.data=JSON.stringify(t)),r&&(n.error={graphQLErrors:r.graphQLErrors.map((function(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}))},r.networkError&&(n.error.networkError=""+r.networkError)),n}(e);n[t.key]=r}}))(p),r.merge([p,l])}};return a.restoreData=function(e){return t._extends(n,e)},a.extractData=function(){return t._extends({},n)},e&&e.initialState&&a.restoreData(e.initialState),a},exports.subscriptionExchange=function(n){var i=n.forwardSubscription,o=n.enableAllOperations;return function(n){var u=n.client,a=n.forward;function s(e){var t=e.kind;return"subscription"===t||!!o&&("query"===t||"mutation"===t)}return function(n){var o=r.share(n),c=r.mergeMap((function(n){var a=n.key,s=r.filter((function(e){return"teardown"===e.kind&&e.key===a}))(o);return r.takeUntil(s)(function(n){var o=i({key:n.key.toString(36),query:e.print(n.query),variables:n.variables,context:t._extends({},n.context)});return r.make((function(e){var r,i=e.next,a=e.complete,s=!1;return Promise.resolve().then((function(){s||(r=o.subscribe({next:function(e){return i(t.makeResult(n,e))},error:function(e){return i(t.makeErrorResult(n,e))},complete:function(){s||(s=!0,"subscription"===n.kind&&u.reexecuteOperation(f("teardown",n,n.context)),a())}}))})),function(){s=!0,r&&r.unsubscribe()}}))}(n))}))(r.filter(s)(o)),p=a(r.filter((function(e){return!s(e)}))(o));return r.merge([c,p])}}};
//# sourceMappingURL=urql-core.min.js.map
